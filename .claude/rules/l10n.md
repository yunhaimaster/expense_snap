---
paths: lib/l10n/**/*.arb, lib/presentation/**/*.dart
---

# i18n / Localization Rules

## 檔案位置

| 檔案 | 用途 |
|------|------|
| `l10n.yaml` | 配置檔 |
| `lib/l10n/app_zh.arb` | 繁體中文（主檔案） |
| `lib/l10n/app_en.arb` | English |
| `lib/generated/l10n.dart` | 自動生成的 `S` class |

## 使用方式

```dart
import 'package:expense_snap/generated/l10n.dart';

// 在 Widget 中
Text(S.of(context).appTitle)

// 帶參數
Text(S.of(context).expenseCount(count))

// 帶金額
Text(S.of(context).totalAmount(formattedAmount))
```

## ARB 格式

### 基本字串
```json
{
  "appTitle": "支出快照",
  "@appTitle": {
    "description": "App 標題"
  }
}
```

### 帶參數
```json
{
  "expenseCount": "共 {count} 筆支出",
  "@expenseCount": {
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

### 複數形式
```json
{
  "itemCount": "{count, plural, =0{沒有項目} =1{1 個項目} other{{count} 個項目}}",
  "@itemCount": {
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

## 命名慣例

| 類型 | 格式 | 範例 |
|------|------|------|
| 標題 | `xxxTitle` | `homeTitle`, `settingsTitle` |
| 按鈕 | `xxxButton` | `saveButton`, `cancelButton` |
| 訊息 | `xxxMessage` | `successMessage`, `errorMessage` |
| 標籤 | `xxxLabel` | `amountLabel`, `dateLabel` |
| 提示 | `xxxHint` | `searchHint`, `inputHint` |
| 錯誤 | `xxxError` | `networkError`, `validationError` |

## 新增字串流程

1. **先加到 `app_zh.arb`**（主檔案）
2. **再加到 `app_en.arb`**
3. **執行生成**
   ```bash
   flutter gen-l10n
   ```
4. **在代碼中使用**
   ```dart
   S.of(context).newKey
   ```

## 驗證

```bash
# 檢查 ARB 語法
dart run intl_utils:generate

# 或手動比對
diff <(jq -r 'keys[]' lib/l10n/app_zh.arb | grep -v "@" | sort) \
     <(jq -r 'keys[]' lib/l10n/app_en.arb | grep -v "@" | sort)
```

## 常見錯誤

### ❌ 硬編碼字串
```dart
Text('儲存') // 錯誤
```

### ✅ 使用 i18n
```dart
Text(S.of(context).saveButton)
```

### ❌ 拼接字串
```dart
Text('共 $count 筆') // 錯誤
```

### ✅ 使用 placeholder
```dart
Text(S.of(context).expenseCount(count))
```

## Service Layer 字串

Service 層無法存取 `context`，使用 `ExportStrings` pattern：

```dart
// 定義
class ExportStrings {
  final String title;
  final String dateLabel;
  // ...
}

// 在 UI 層創建
final strings = ExportStrings(
  title: S.of(context).exportTitle,
  dateLabel: S.of(context).dateLabel,
);

// 傳給 service
await exportService.export(data, strings);
```
